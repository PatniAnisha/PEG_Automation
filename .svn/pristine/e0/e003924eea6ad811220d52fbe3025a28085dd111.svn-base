package com.zycus.eInvoice.Payment;

import java.util.Date;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;

import com.relevantcodes.extentreports.ExtentTest;
import com.relevantcodes.extentreports.LogStatus;

import Common.eInvoice_CommonFunctions;

public class NewPaymentBatch extends eInvoice_CommonFunctions {

	private WebDriver driver;
	private ExtentTest logger;
	private String batchNo;
	private String currency;
	private By pgHead = By.id("cntPayBatch");
	private String company;
	private String bankAcct;
	
	/**
	 * Constructor for the class
	 * 
	 * @param driver
	 * @param logger
	 * 
	 */
	
	public NewPaymentBatch(WebDriver driver, ExtentTest logger) {
		super(driver, logger);
		this.driver = driver;
		this.logger = logger;
	}
	
	/**
	 * Constructor for the class
	 * 
	 * @param driver
	 * @param logger
	 * @param batchNo
	 * @param currency
	 * @param company
	 * @param bankAcct
	 * 
	 */
	
	public NewPaymentBatch(WebDriver driver, ExtentTest logger, String batchNo, String currency, String company,
			String bankAcct) {
		super(driver, logger);
		this.driver = driver;
		this.logger = logger;
		this.company = company;
		this.bankAcct = bankAcct;
		this.batchNo = batchNo;
		this.currency = currency;
	}

	/**
	 * @return the pgHead
	 */
	public By getPgHead() {
		return pgHead;
	}

	/**
	 * @param pgHead
	 *            the pgHead to set
	 */
	public void setPgHead(By pgHead) {
		this.pgHead = pgHead;
	}
	
	/**
	 * <b>Function:</b> selectOrgUnit_and_Bank
	 * 
	 * @author Varun Khurana
	 * @since May 2018
	 * @param None
	 * @return result - True/False
	 * @throws Exception
	 */
	
	private void selectOrgUnit_and_Bank() throws Exception {
		try {
			findElement(By.id("lnkOU")).click();
			if (findElement(By.xpath("//div[div/span[text()='Select Organization Unit and Bank Details']]"))
					.isDisplayed()) {
				findElement(By.id("txtOrganizationalUnit")).sendKeys(company);
				waitUntilInvisibilityOfElement(By.xpath("//div[contains(@aria-describedby,'status_overlay_loadingTree')]"));
				if(findElement(By.xpath("//div[@class='treeContainer treeview']/ul"))!=null){
					findElement(By.xpath("//select[@id='txtBankName']/option[text()='"+bankAcct+"']")).click();
					
					//Selecting first organization unit from the displayed list tree
					findElement(By.xpath("//div[@class='treeContainer treeview']//li[1]//input")).click();
					try{
						findElement(By.xpath("//input[@value='Save']")).click();
					}catch(Exception e){
						if(findElement(By.xpath("//div[contains(@class,'promptbx')][//td[contains(text(),'Please select atleast one Organization Unit')]]")).isDisplayed())
							findElement(By.xpath("//button/span[text()='OK']")).click();
						logger.log(LogStatus.INFO, "Please select atleast one Organization Unit - message displayed");
					}
				}else
					logger.log(LogStatus.INFO, "No results found - message displayed");
					
			}
		} catch (Exception e) {
			e.printStackTrace();
			throw new Exception();
		}
	}
	
	/**
	 * <b>Function:</b> enterBatchDetails
	 * 
	 * @author Varun Khurana
	 * @since May 2018
	 * @param scheduledFor
	 * @param approver
	 * @param notes
	 * @param reviewer
	 * @return result - True/False
	 * @throws Exception
	 */
	
	private void enterBatchDetails(Date scheduledFor, String approver, String notes, String reviewer) throws Exception {
		try {
			selectOrgUnit_and_Bank();
			findElement(By.id("txtBatchNo")).sendKeys(batchNo);
			findElement(By.id("txtCurrency")).sendKeys(currency);
			selectDate(scheduledFor);
			findElement(By.id("txtApprover")).sendKeys(approver);
			findElement(By.id("txtBatchComments")).sendKeys(notes);
			findElement(By.id("txtReviewer")).sendKeys(reviewer);
		} catch (Exception e) {
			e.printStackTrace();
			throw new Exception();
		}
	}

}
